<div class="giscus"></div>
<script>
    // Función para obtener el tema actual de Blowfish
    function getGiscusTheme() {
        // Blowfish usa 'appearance' en localStorage
        const appearance = localStorage.getItem('appearance') || 'light';
        return appearance === 'dark' ? 'dark' : 'light';
    }

    // Función para actualizar el tema de giscus
    function setGiscusTheme() {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        
        iframe.contentWindow.postMessage(
            { giscus: { setConfig: { theme: getGiscusTheme() } } },
            'https://giscus.app'
        );
    }

    // Cargar giscus con el tema correcto
    document.addEventListener('DOMContentLoaded', function () {
        const giscusAttributes = {
            "src": "https://giscus.app/client.js",
            "data-repo": "PGSCOM/blog",
            "data-repo-id": "R_kgDONtqgrw",
            "data-category": "Comentarios Blog",
            "data-category-id": "DIC_kwDONtqgr84Cmnae",
            "data-mapping": "title",
            "data-strict": "1",
            "data-reactions-enabled": "1",
            "data-emit-metadata": "0",
            "data-input-position": "top",
            "data-theme": getGiscusTheme(),
            "data-lang": "es",
            "data-loading": "lazy",
            "crossorigin": "anonymous",
            "async": "",
        };

        const giscusScript = document.createElement("script");
        Object.entries(giscusAttributes).forEach(
            ([key, value]) => giscusScript.setAttribute(key, value)
        );
        document.querySelector('.giscus').appendChild(giscusScript);

        // Escuchar cambios en el tema del sitio
        const observer = new MutationObserver(() => {
            setGiscusTheme();
        });
        
        observer.observe(document.documentElement, {
            attributes: true,
            attributeFilter: ['class', 'data-theme']
        });
    });
</script>