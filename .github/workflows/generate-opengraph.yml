name: Generar OpenGraph Image

on:
  workflow_dispatch:

permissions:
  contents: write

defaults:
  run:
    shell: bash

jobs:
  generate:
    runs-on: ubuntu-latest
    steps:
      - name: Check out repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          persist-credentials: true

      - name: Install ImageMagick
        run: |
          sudo apt-get update
          sudo apt-get install -y imagemagick

      - name: Generate OpenGraph Background
        run: |
          chmod +x ./generate_opengraph_bg.sh
          ./generate_opengraph_bg.sh ./assets/logomono.png ./assets/opengraph.png

      - name: Commit and push generated image
        env:
          GIT_AUTHOR_NAME: github-actions[bot]
          GIT_AUTHOR_EMAIL: github-actions[bot]@users.noreply.github.com
        run: |
          git config user.name "${GIT_AUTHOR_NAME}"
          git config user.email "${GIT_AUTHOR_EMAIL}"
          git add ./assets/opengraph.png || true
          if git diff --cached --quiet; then
            echo "No changes to commit"
          else
            git commit -m "chore: update opengraph image"
            git push origin HEAD:main
          fi
